---
description: 
alwaysApply: true
enabled: true
updatedAt: 2026-01-16T03:15:09.418Z
provider: 
---

# FinancialApp é¡¹ç›®å¼€å‘è§„èŒƒï¼ˆSpring MVC + JPA/Hibernate + Docker + Gradle + JUnitï¼‰

## ğŸ“– è§„åˆ™è¯´æ˜

**åˆ†çº§ä½“ç³»**ï¼š
- `MUST` å¿…é¡» - å¼ºåˆ¶æ‰§è¡Œï¼Œè¿åä¼šå¯¼è‡´ä¸¥é‡é—®é¢˜
- `SHOULD` å¼ºçƒˆå»ºè®® - é™¤éæœ‰å……åˆ†ç†ç”±ï¼Œå¦åˆ™å¿…é¡»éµå®ˆ
- `MAY` å¯é€‰ - æ ¹æ®é¡¹ç›®éœ€æ±‚çµæ´»é€‰æ‹©

**ç›®æ ‡**ï¼šè§„èŒƒä¸ä»…æ˜¯"å†™å¾—å¯¹"ï¼Œæ›´è¦èƒ½é€šè¿‡ Gradle/CI/Docker ç›´æ¥è½åœ°æ‰§è¡Œã€‚

---

## 1ï¸âƒ£ å·¥ç¨‹ç»“æ„ï¼ˆæ¨èåˆ†å±‚æ¶æ„ï¼‰

### å½“å‰é¡¹ç›®ç»“æ„
```
src/main/kotlin/com/financialapp/
  FinancialAppApplication.kt          # åº”ç”¨å…¥å£
  config/                             # é…ç½®å±‚
    JpaConfig.kt
    SecurityConfig.kt
    RSAConfig.kt
    FileUploadConfig.kt
    WebConfig.kt
  controller/                         # Web å±‚ï¼šHTTP é€‚é…
    AuthController.kt
    UserController.kt
    RSAController.kt
  service/                            # ä¸šåŠ¡æœåŠ¡å±‚
    AuthService.kt
    UserService.kt
    FileStorageService.kt
    RSAService.kt
  repository/                         # æ•°æ®è®¿é—®å±‚
    UserRepository.kt
  entity/                             # JPA å®ä½“ï¼ˆä¸ç›´æ¥æš´éœ²ç»™å¤–éƒ¨ï¼‰
    User.kt
  dto/                                # æ•°æ®ä¼ è¾“å¯¹è±¡
    request/                          # è¯·æ±‚ DTO
    response/                         # å“åº” DTO
  exception/                          # å¼‚å¸¸å¤„ç†
    BusinessException.kt
    GlobalExceptionHandler.kt
  filter/                             # è¿‡æ»¤å™¨
    RequestLoggingFilter.kt
  security/                           # å®‰å…¨ç›¸å…³
    JwtTokenProvider.kt
    JwtAuthenticationFilter.kt
    CustomUserDetailsService.kt
    CustomAuthenticationEntryPoint.kt
    UserDetailsImpl.kt
  util/                               # å·¥å…·ç±»
    ResponseUtil.kt
    RSAUtil.kt
src/main/resources/
  application.yml                     # ä¸»é…ç½®æ–‡ä»¶
  application-dev.yml                 # å¼€å‘ç¯å¢ƒé…ç½®
  application-prod.yml                # ç”Ÿäº§ç¯å¢ƒé…ç½®
src/test/kotlin/...                   # æµ‹è¯•ä»£ç 
```

### åˆ†å±‚èŒè´£è¯´æ˜

| å±‚çº§ | èŒè´£ | è¯´æ˜ |
|------|------|------|
| **Controller** | HTTP é€‚é… | å‚æ•°æ ¡éªŒã€é‰´æƒã€è°ƒç”¨ Serviceã€è¿”å›å“åº” |
| **Service** | ä¸šåŠ¡é€»è¾‘ | ç”¨ä¾‹ç¼–æ’ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™å¤„ç† |
| **Repository** | æ•°æ®è®¿é—® | æ•°æ®åº“æ“ä½œã€æŸ¥è¯¢å°è£… |
| **Entity** | æŒä¹…åŒ–æ¨¡å‹ | JPA æ˜ å°„ï¼Œä¸ç›´æ¥æš´éœ²ç»™ API |
| **DTO** | æ•°æ®ä¼ è¾“ | API è¯·æ±‚/å“åº”å¯¹è±¡ï¼Œä¸ Entity è§£è€¦ |

### è§„èŒƒè¦æ±‚

- âœ… **MUST** Controller ä¿æŒè–„ï¼šåªåšå‚æ•°æ ¡éªŒã€é‰´æƒã€è°ƒç”¨ Serviceã€è¿”å›å“åº”
- âœ… **MUST** Entity ä¸å¾—ç›´æ¥æš´éœ²ç»™ API Responseï¼Œå¿…é¡»æ˜ å°„åˆ° DTO
- âœ… **MUST** ä½¿ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œç¦æ­¢å­—æ®µæ³¨å…¥ï¼ˆ`@Autowired lateinit var`ï¼‰
- âœ… **SHOULD** äº‹åŠ¡è¾¹ç•Œæ˜ç¡®ï¼š`@Transactional` æ”¾åœ¨ Service æ–¹æ³•ä¸Š
- âœ… **SHOULD** é¿å…ä½¿ç”¨ `!!`ï¼Œå¤–éƒ¨è¾“å…¥å¿…é¡»æ ¡éªŒ

---

## 2ï¸âƒ£ Kotlin + Spring ä½¿ç”¨è§„èŒƒ

### 2.1 ä¾èµ–æ³¨å…¥

**âœ… æ¨èï¼ˆæ„é€ å™¨æ³¨å…¥ï¼‰**ï¼š
```kotlin
@Service
class UserService(
    private val userRepository: UserRepository,
    private val passwordEncoder: PasswordEncoder
) {
    // ä¸šåŠ¡é€»è¾‘
}
```

**âŒ ç¦æ­¢ï¼ˆå­—æ®µæ³¨å…¥ï¼‰**ï¼š
```kotlin
@Service
class UserService {
    @Autowired
    private lateinit var userRepository: UserRepository  // âŒ ç¦æ­¢
}
```

### 2.2 Controller è§„èŒƒ

```kotlin
@RestController
@RequestMapping("/users")
class UserController(
    private val userService: UserService
) {
    @GetMapping("/{id}")
    fun getUserById(@PathVariable id: Long): ResponseEntity<ApiResponse<UserResponse>> {
        val user = userService.getUserById(id)
        return ResponseEntity.ok(ApiResponse.success(user))
    }

    @PostMapping
    @ResponseStatus(HttpStatus.CREATED)
    fun createUser(@Valid @RequestBody request: UserCreateRequest): ApiResponse<UserResponse> {
        val user = userService.createUser(request)
        return ApiResponse.success(user)
    }
}
```

### 2.3 ç»Ÿä¸€å¼‚å¸¸å¤„ç†

é¡¹ç›®å·²å®ç° `GlobalExceptionHandler`ï¼Œæ ‡å‡†é”™è¯¯å“åº”æ ¼å¼ï¼š

```json
{
  "timestamp": "2024-01-16T10:30:00",
  "status": 400,
  "error": "Validation Error",
  "message": "è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥",
  "errors": {
    "username": "ç”¨æˆ·åä¸èƒ½ä¸ºç©º"
  }
}
```

**å½“å‰å·²å¤„ç†çš„å¼‚å¸¸ç±»å‹**ï¼š
- âœ… `BusinessException` - ä¸šåŠ¡å¼‚å¸¸
- âœ… `BadCredentialsException` - è®¤è¯å¤±è´¥
- âœ… `AuthenticationException` - è®¤è¯å¼‚å¸¸
- âœ… `MethodArgumentNotValidException` - å‚æ•°æ ¡éªŒå¼‚å¸¸
- âœ… `Exception` - é€šç”¨å¼‚å¸¸

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** æ‰€æœ‰å¼‚å¸¸é€šè¿‡ `@RestControllerAdvice` ç»Ÿä¸€å¤„ç†
- âœ… **MUST** é”™è¯¯å“åº”è„±æ•ï¼šä¸è¿”å›å †æ ˆä¿¡æ¯ç»™å®¢æˆ·ç«¯
- âœ… **MUST** å†…éƒ¨æ—¥å¿—ä¿ç•™å®Œæ•´é”™è¯¯ä¿¡æ¯ä¾¿äºæ’æŸ¥
- âœ… **SHOULD** ä½¿ç”¨è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ï¼ˆ`BusinessException`ï¼‰å¤„ç†ä¸šåŠ¡é”™è¯¯

---

## 3ï¸âƒ£ JPA/Hibernate è§„åˆ™ï¼ˆæ•°æ®åº“æ“ä½œï¼‰

### 3.1 æ ¸å¿ƒé…ç½®

**âœ… å½“å‰é…ç½®ï¼ˆç¬¦åˆè§„èŒƒï¼‰**ï¼š
```yaml
spring:
  jpa:
    open-in-view: false              # âœ… å·²ç¦ç”¨ OSIV
    hibernate:
      ddl-auto: update               # âš ï¸ ç”Ÿäº§ç¯å¢ƒåº”æ”¹ä¸º validate/none
    show-sql: true                   # âœ… å¼€å‘ç¯å¢ƒå¯ç”¨
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
        format_sql: true             # âœ… æ ¼å¼åŒ– SQL
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** ç¦ç”¨ OSIVï¼š`spring.jpa.open-in-view=false`
- âœ… **MUST** ç”Ÿäº§ç¯å¢ƒç¦ç”¨ `ddl-auto: update`ï¼Œä½¿ç”¨ Flyway ç®¡ç†æ•°æ®åº“å˜æ›´
- âœ… **MUST** æ‰€æœ‰ schema å˜æ›´å¿…é¡»é€šè¿‡ Flyway è„šæœ¬ï¼Œç¦æ­¢ç›´æ¥ä¿®æ”¹æ•°æ®åº“

### 3.2 N+1 æŸ¥è¯¢é—®é¢˜é˜²èŒƒ

**âœ… é¿å…ç­–ç•¥**ï¼š
```kotlin
// âŒ é”™è¯¯ï¼šä¼šäº§ç”Ÿ N+1 é—®é¢˜
val users = userRepository.findAll()
users.forEach { println(it.role.name) }  // æ¯ä¸ªç”¨æˆ·éƒ½è§¦å‘ä¸€æ¬¡æŸ¥è¯¢

// âœ… æ–¹æ¡ˆ1ï¼šä½¿ç”¨ JOIN FETCH
@Query("SELECT u FROM User u LEFT JOIN FETCH u.role")
fun findAllWithRoles(): List<User>

// âœ… æ–¹æ¡ˆ2ï¼šä½¿ç”¨ @EntityGraph
@EntityGraph(attributePaths = ["role"])
fun findAll(): List<User>

// âœ… æ–¹æ¡ˆ3ï¼šæ‰¹é‡æŠ“å–
@Query("SELECT u FROM User u WHERE u.id IN :ids")
fun findByIds(@Param("ids") ids: List<Long>): List<User>
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** åˆ—è¡¨æŸ¥è¯¢å¿…é¡»æ£€æŸ¥ SQLï¼Œé¿å… N+1 é—®é¢˜
- âœ… **MUST** éœ€è¦å…³è”æ•°æ®æ—¶ä½¿ç”¨ `JOIN FETCH` / `@EntityGraph` / æ‰¹é‡æŠ“å–
- âœ… **SHOULD** åˆ†é¡µæŸ¥è¯¢é¿å… fetch joinï¼Œä½¿ç”¨ DTO æŠ•å½±æˆ–ä¸¤æ®µæŸ¥è¯¢

### 3.3 çº§è”æ“ä½œä¸å…³ç³»æ˜ å°„

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** `cascade` åªåœ¨èšåˆè¾¹ç•Œå†…ä½¿ç”¨ï¼Œç¦æ­¢å…¨å±€çº§è”
- âœ… **MUST** æ˜ç¡®å…³ç³»æ˜ å°„ï¼š`@OneToMany`ã€`@ManyToOne`ã€`@ManyToMany`
- âœ… **SHOULD** æ ¸å¿ƒèšåˆä½¿ç”¨ `@Version` ä¹è§‚é”

```kotlin
@Entity
data class User(
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    val id: Long? = null,

    @Version  // ä¹è§‚é”
    var version: Int = 0,

    @OneToMany(mappedBy = "user", cascade = [CascadeType.ALL], orphanRemoval = true)
    val orders: MutableList<Order> = mutableListOf()  // âœ… èšåˆå†…çº§è”
)
```

### 3.4 æ•°æ®åº“è¿ç§»

**æ¨èä½¿ç”¨ Flyway**ï¼ˆå½“å‰é¡¹ç›®å°šæœªå®ç°ï¼‰ï¼š

```
src/main/resources/db/migration/
  V1__create_users_table.sql
  V2__create_orders_table.sql
  V3__add_user_status_field.sql
```

**Gradle ä¾èµ–**ï¼š
```kotlin
implementation("org.flywaydb:flyway-core")
implementation("org.flywaydb:flyway-mysql")
```

---

## 4ï¸âƒ£ é…ç½®ä¸å±æ€§ç®¡ç†

### 4.1 é…ç½®æ–‡ä»¶åˆ†ç¦»

**âœ… å½“å‰å®ç°**ï¼š
```
src/main/resources/
  application.yml              # ä¸»é…ç½®
  application-dev.yml          # å¼€å‘ç¯å¢ƒ
  application-prod.yml         # ç”Ÿäº§ç¯å¢ƒï¼ˆéœ€åˆ›å»ºï¼‰
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** ä½¿ç”¨ profile åˆ†ç¦»ç¯å¢ƒé…ç½®
- âœ… **MUST** æ•æ„Ÿé…ç½®ï¼ˆå¯†ç ã€å¯†é’¥ï¼‰é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥
- âœ… **MUST** ç”Ÿäº§ç¯å¢ƒé…ç½®ç¦æ­¢æäº¤åˆ°ä»£ç ä»“åº“

### 4.2 ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§

**æ¨èä½¿ç”¨ `@ConfigurationProperties`**ï¼ˆå½“å‰å¯æ”¹è¿›ï¼‰ï¼š

```kotlin
@Configuration
@ConfigurationProperties(prefix = "app")
@Validated
data class AppProperties(
    val jwt: JwtProperties,
    val cors: CorsProperties,
    val upload: UploadProperties
) {
    data class JwtProperties(
        @NotBlank
        val secret: String,
        @Min(3600000)
        val expiration: Long
    )

    data class CorsProperties(
        val allowedOrigins: List<String>,
        val allowedMethods: List<String>,
        val allowCredentials: Boolean = true
    )

    data class UploadProperties(
        val location: String,
        val maxFileSize: Long
    )
}
```

**ä½¿ç”¨æ–¹å¼**ï¼š
```kotlin
@Service
class FileStorageService(
    private val appProperties: AppProperties
) {
    private val uploadLocation = Path.of(appProperties.upload.location)
}
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** ä½¿ç”¨ `@ConfigurationProperties` + `@Validated` ç®¡ç†é…ç½®
- âœ… **SHOULD** ä¸ºå¤–éƒ¨ä¾èµ–ï¼ˆDB/HTTPï¼‰æä¾›é»˜è®¤å€¼ä¸æ ¡éªŒ
- âŒ **ç¦æ­¢** æ•£è½ä½¿ç”¨ `@Value` æ³¨è§£

---

## 5ï¸âƒ£ æ—¥å¿—ã€ç›‘æ§ã€å¥åº·æ£€æŸ¥

### 5.1 å½“å‰é…ç½®

**âœ… æ—¥å¿—é…ç½®ï¼ˆå·²å®ç°ï¼‰**ï¼š
```yaml
logging:
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %highlight(%-5level) %cyan(%logger{36}) - %msg%n"
  level:
    root: INFO
    com.financialapp: DEBUG
    org.hibernate.SQL: DEBUG
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** æ—¥å¿—å¯è§‚æµ‹ï¼šåŒ…å«æ—¶é—´æˆ³ã€çº¿ç¨‹ã€æ—¥å¿—çº§åˆ«ã€ç±»å
- âœ… **MUST** ç¦æ­¢æ‰“å°æ•æ„Ÿå­—æ®µï¼ˆtoken/passwordï¼‰
- âš ï¸ **SHOULD** æ¥å…¥ Actuatorï¼ˆå½“å‰æœªå®ç°ï¼‰

### 5.2 Actuator ç›‘æ§ï¼ˆå¾…å®ç°ï¼‰

**æ·»åŠ ä¾èµ–**ï¼š
```kotlin
implementation("org.springframework.boot:spring-boot-starter-actuator")
```

**é…ç½®**ï¼š
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true  # å¯ç”¨ liveness/readiness æ¢é’ˆ
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true
```

**å¥åº·æ£€æŸ¥ç«¯ç‚¹**ï¼š
- `/actuator/health/liveness` - å­˜æ´»æ¢é’ˆ
- `/actuator/health/readiness` - å°±ç»ªæ¢é’ˆ
- `/actuator/health` - ç»¼åˆå¥åº·çŠ¶æ€

**è§„èŒƒè¦æ±‚**ï¼š
- âš ï¸ **MUST** æ¥å…¥ Actuator å¹¶å¯ç”¨ liveness/readinessï¼ˆå¾…å®ç°ï¼‰
- âœ… **SHOULD** ä½¿ç”¨ Micrometer æŒ‡æ ‡ï¼ˆå¯é€‰ï¼‰
- âœ… **MAY** æ¥å…¥ OpenTelemetry é“¾è·¯è¿½è¸ªï¼ˆåç»­æ‰©å±•ï¼‰

---

## 6ï¸âƒ£ å®‰å…¨è§„èŒƒ

### 6.1 Spring Security é…ç½®

**âœ… å½“å‰å·²å®ç°**ï¼š
```kotlin
@Configuration
@EnableWebSecurity
class SecurityConfig(
    private val jwtAuthenticationFilter: JwtAuthenticationFilter,
    private val authenticationEntryPoint: CustomAuthenticationEntryPoint
) {
    @Bean
    fun securityFilterChain(http: HttpSecurity): SecurityFilterChain {
        http
            .csrf { it.disable() }
            .sessionManagement { it.sessionCreationPolicy(SessionCreationPolicy.STATELESS) }
            .authorizeHttpRequests {
                it.requestMatchers("/api/auth/**").permitAll()
                  .requestMatchers("/swagger-ui/**", "/v3/api-docs/**").permitAll()
                  .anyRequest().authenticated()
            }
            .exceptionHandling { it.authenticationEntryPoint(authenticationEntryPoint) }
            .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter::class.java)
        return http.build()
    }
}
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** ä½¿ç”¨ Spring Security ä¿æŠ¤ API
- âœ… **MUST** æ˜ç¡®å…¬å¼€è·¯å¾„ä¸å—ä¿æŠ¤è·¯å¾„
- âœ… **MUST** ä½¿ç”¨ JWT è¿›è¡Œæ— çŠ¶æ€è®¤è¯

### 6.2 è¾“å…¥æ ¡éªŒ

**âœ… å·²é›†æˆ Bean Validation**ï¼š
```kotlin
@RestController
class UserController(
    private val userService: UserService
) {
    @PostMapping
    fun createUser(@Valid @RequestBody request: UserCreateRequest): ApiResponse<UserResponse> {
        // è‡ªåŠ¨æ ¡éªŒè¯·æ±‚å‚æ•°
    }
}

data class UserCreateRequest(
    @field:NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @field:Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¹‹é—´")
    val username: String,

    @field:NotBlank(message = "é‚®ç®±ä¸èƒ½ä¸ºç©º")
    @field:Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    val email: String,

    @field:NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    @field:Size(min = 6, message = "å¯†ç è‡³å°‘6ä½")
    val password: String
)
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** æ‰€æœ‰å¤–éƒ¨è¾“å…¥ä½¿ç”¨ `@Valid` + çº¦æŸæ³¨è§£
- âœ… **MUST** Controller æ–¹æ³•å‚æ•°æ·»åŠ  `@Valid`
- âœ… **SHOULD** è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£å¤„ç†å¤æ‚ä¸šåŠ¡è§„åˆ™

### 6.3 é”™è¯¯å“åº”è„±æ•

**âœ… å·²å®ç°**ï¼š
- âœ… å®¢æˆ·ç«¯åªè¿”å›æ ‡å‡†é”™è¯¯ä½“ï¼Œä¸åŒ…å«å †æ ˆ
- âœ… æœåŠ¡ç«¯æ—¥å¿—ä¿ç•™å®Œæ•´é”™è¯¯ä¿¡æ¯

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** é”™è¯¯å“åº”è„±æ•ï¼Œå †æ ˆä¸ç›´æ¥è¿”å›å®¢æˆ·ç«¯
- âœ… **MUST** æ—¥å¿—è®°å½• requestId/traceId ä¾¿äºå®šä½ï¼ˆå¾…å®ç°ï¼‰
- âœ… **SHOULD** CI å¼•å…¥ä¾èµ–æ¼æ´æ‰«æ

---

## 7ï¸âƒ£ API æ–‡æ¡£

### 7.1 SpringDoc OpenAPI

**âœ… å·²é›†æˆ SpringDoc**ï¼š
```yaml
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
  packages-to-scan: com.financialapp.controller
```

**è®¿é—®åœ°å€**ï¼š
- Swagger UI: http://localhost:8080/api/swagger-ui.html
- OpenAPI JSON: http://localhost:8080/api/v3/api-docs

**ä½¿ç”¨æ³¨è§£**ï¼š
```kotlin
@RestController
@RequestMapping("/users")
@Tag(name = "ç”¨æˆ·ç®¡ç†", description = "ç”¨æˆ·å¢åˆ æ”¹æŸ¥æ¥å£")
class UserController {

    @Operation(summary = "è·å–ç”¨æˆ·è¯¦æƒ…", description = "æ ¹æ® ID è·å–ç”¨æˆ·ä¿¡æ¯")
    @ApiResponses(
        value = [
            ApiResponse(responseCode = "200", description = "æˆåŠŸ"),
            ApiResponse(responseCode = "404", description = "ç”¨æˆ·ä¸å­˜åœ¨")
        ]
    )
    @GetMapping("/{id}")
    fun getUserById(@PathVariable id: Long): ResponseEntity<ApiResponse<UserResponse>>

    @Operation(summary = "åˆ›å»ºç”¨æˆ·")
    @PostMapping
    fun createUser(
        @Valid @RequestBody request: UserCreateRequest,
        @Parameter(description = "ç”¨æˆ·åˆ›å»ºè¯·æ±‚å‚æ•°")  // å¯é€‰æè¿°
    ): ResponseEntity<ApiResponse<UserResponse>>
}
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** ä½¿ç”¨ springdoc-openapi ç”Ÿæˆæ–‡æ¡£
- âœ… **SHOULD** ä¸º API æä¾›æ¸…æ™°çš„ summary å’Œ description
- âœ… **SHOULD** ç»Ÿä¸€é”™è¯¯ç ã€åˆ†é¡µã€é‰´æƒæ–¹å¼è¯´æ˜

---

## 8ï¸âƒ£ Gradle æ„å»ºè§„èŒƒ

### 8.1 å½“å‰é…ç½®

**âœ… å·²ä½¿ç”¨ Gradleï¼ˆKotlin DSLï¼‰**ï¼š
```kotlin
plugins {
    id("org.springframework.boot") version "3.2.0"
    id("io.spring.dependency-management") version "1.1.4"
    kotlin("jvm") version "1.9.20"
    kotlin("plugin.spring") version "1.9.20"
    kotlin("plugin.jpa") version "1.9.20"
}

group = "com.financialapp"
version = "1.0.0"

java {
    sourceCompatibility = JavaVersion.VERSION_17
}
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** å›ºå®š JDK/Kotlin/Spring Boot ç‰ˆæœ¬
- âœ… **MUST** ä½¿ç”¨ Kotlin DSLï¼ˆ`.kts` æ–‡ä»¶ï¼‰
- âš ï¸ **SHOULD** å¯ç”¨ä¾èµ–ç‰ˆæœ¬æ ¡éªŒï¼ˆå¾…å®ç°ï¼‰

### 8.2 ä»£ç è´¨é‡æ’ä»¶ï¼ˆå¾…å®ç°ï¼‰

**æ¨èæ·»åŠ çš„æ’ä»¶**ï¼š

```kotlin
plugins {
    // Detektï¼šKotlin é™æ€ä»£ç æ£€æŸ¥
    id("io.gitlab.arturbosch.detekt") version "1.23.4"

    // Ktlintï¼šKotlin ä»£ç æ ¼å¼åŒ–
    id("org.jlleitschuh.gradle.ktlint") version "12.1.0"

    // JaCoCoï¼šä»£ç è¦†ç›–ç‡
    jacoco
}

// Detekt é…ç½®
detekt {
    config.setFrom(files("$projectDir/config/detekt/detekt.yml"))
    buildUponDefaultConfig = true
}

// JaCoCo é…ç½®
jacoco {
    toolVersion = "0.8.11"
}

tasks.jacocoTestReport {
    dependsOn(tasks.test)
    reports {
        xml.required.set(true)
        html.required.set(true)
        csv.required.set(false)
    }

    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.map {
            fileTree(it) {
                exclude(
                    "**/config/**",
                    "**/dto/**",
                    "**/entity/**",
                    "**/Application.kt"
                )
            }
        }))
    }
}

// è¦†ç›–ç‡æ£€æŸ¥
tasks.jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                minimum = "0.70".toBigDecimal()  // 70% è¦†ç›–ç‡
            }
        }
        rule {
            element = "PACKAGE"
            includes = listOf("com.financialapp.service.*", "com.financialapp.repository.*")
            limit {
                minimum = "0.80".toBigDecimal()  // å…³é”®åŒ… 80%
            }
        }
    }
}

// å°†è¦†ç›–ç‡éªŒè¯ç»‘å®šåˆ°æµ‹è¯•ä»»åŠ¡
tasks.check {
    dependsOn(tasks.jacocoTestCoverageVerification)
}
```

### 8.3 æµ‹è¯•è§„èŒƒ

**å½“å‰æµ‹è¯•ä¾èµ–**ï¼š
```kotlin
testImplementation("org.springframework.boot:spring-boot-starter-test")
testImplementation("org.springframework.security:spring-security-test")
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** ä½¿ç”¨ JUnit 5 è¿›è¡Œå•å…ƒæµ‹è¯•
- âœ… **MUST** domain/service å±‚å•æµ‹è¦†ç›–æ ¸å¿ƒä¸šåŠ¡è§„åˆ™
- âš ï¸ **SHOULD** repository å±‚ä½¿ç”¨ Testcontainers é›†æˆæµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
- âœ… **SHOULD** controller å±‚ä½¿ç”¨ MockMvc æµ‹è¯• API åˆåŒ

**æµ‹è¯•ç¤ºä¾‹**ï¼š
```kotlin
@SpringBootTest
@AutoConfigureMockMvc
class UserControllerTest {

    @Autowired
    private lateinit var mockMvc: MockMvc

    @MockBean
    private lateinit var userService: UserService

    @Test
    fun `should return user when user exists`() {
        // Given
        val user = UserResponse(1L, "testuser", "test@example.com")
        `when`(userService.getUserById(1L)).thenReturn(user)

        // When & Then
        mockMvc.perform(get("/users/1"))
            .andExpect(status().isOk)
            .andExpect(jsonPath("$.data.username").value("testuser"))
    }
}
```

---

## 9ï¸âƒ£ Docker æ„å»ºä¸è¿è¡Œ

### 9.1 Dockerfileï¼ˆå½“å‰å·²å®ç°ï¼‰

**âœ… å½“å‰é…ç½®**ï¼š
```dockerfile
FROM openjdk:17-jdk-slim
LABEL maintainer="FinancialApp Team"
WORKDIR /app
COPY build/libs/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** å›ºå®šåŸºç¡€é•œåƒç‰ˆæœ¬
- âš ï¸ **SHOULD** å®¹å™¨å†…è¿è¡Œç”¨æˆ·é rootï¼ˆå¾…ä¼˜åŒ–ï¼‰
- âš ï¸ **MUST** æ·»åŠ å¥åº·æ£€æŸ¥ï¼ˆå¾…å®ç°ï¼‰

**ä¼˜åŒ–å»ºè®®**ï¼š
```dockerfile
FROM openjdk:17-jdk-slim AS builder
WORKDIR /app
COPY . .
RUN ./gradlew clean build -x test --no-daemon

FROM openjdk:17-jdk-slim
LABEL maintainer="FinancialApp Team"

# åˆ›å»ºé root ç”¨æˆ·
RUN groupadd -r appuser && useradd -r -g appuser appuser

WORKDIR /app
COPY --from=builder /app/build/libs/*.jar app.jar
RUN chown -R appuser:appuser /app

USER appuser
EXPOSE 8080

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=60s --retries=3 \
  CMD curl -f http://localhost:8080/api/actuator/health || exit 1

ENTRYPOINT ["java", \
  "-XX:+UseContainerSupport", \
  "-XX:MaxRAMPercentage=75.0", \
  "-jar", "app.jar"]
```

### 9.2 Docker Compose

**âœ… å½“å‰å·²å®ç°**ï¼š
```yaml
version: '3.8'
services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: financial_app
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  app:
    build: .
    ports:
      - "8080:8080"
    depends_on:
      - mysql
      - redis
    environment:
      SPRING_PROFILES_ACTIVE: prod

volumes:
  mysql-data:
```

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** æ•°æ®æŒä¹…åŒ–ï¼ˆå·²é…ç½® volumesï¼‰
- âœ… **MUST** ç¯å¢ƒå˜é‡é…ç½®
- âœ… **SHOULD** JVM å‚æ•°å®¹å™¨å‹å¥½ï¼ˆå¾…ä¼˜åŒ–ï¼‰

---

## ğŸ”Ÿ æµ‹è¯•ç­–ç•¥

### 10.1 æµ‹è¯•é‡‘å­—å¡”

```
        /\
       /E2E\        â† å°‘é‡ç«¯åˆ°ç«¯æµ‹è¯•
      /------\
     / é›†æˆæµ‹è¯• \    â† ä¸­ç­‰æ•°é‡é›†æˆæµ‹è¯•ï¼ˆTestcontainersï¼‰
    /----------\
   /   å•å…ƒæµ‹è¯•   \  â† å¤§é‡å•å…ƒæµ‹è¯•
  /______________\
```

### 10.2 æµ‹è¯•åˆ†å±‚

| å±‚çº§ | æµ‹è¯•ç±»å‹ | æ¡†æ¶/å·¥å…· | è¦†ç›–èŒƒå›´ |
|------|---------|----------|---------|
| **Domain** | å•å…ƒæµ‹è¯• | JUnit 5 + MockK | ä¸šåŠ¡è§„åˆ™ |
| **Service** | å•å…ƒæµ‹è¯• | JUnit 5 + MockK | ç”¨ä¾‹é€»è¾‘ |
| **Repository** | é›†æˆæµ‹è¯• | Testcontainers + MySQL | æ•°æ®è®¿é—® |
| **Controller** | é›†æˆæµ‹è¯• | MockMvc + SpringBootTest | API åˆåŒ |
| **E2E** | ç«¯åˆ°ç«¯ | Testcontainers | å®Œæ•´æµç¨‹ |

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** domain/service å±‚å•æµ‹è¦†ç›–æ ¸å¿ƒä¸šåŠ¡è§„åˆ™
- âœ… **MUST** æ¯ä¸ª Bug å¿…é¡»è¡¥å›å½’æµ‹è¯•
- âš ï¸ **SHOULD** repository å±‚ä½¿ç”¨ Testcontainersï¼ˆå¾…å®ç°ï¼‰
- âœ… **SHOULD** controller å±‚ä½¿ç”¨ MockMvc æµ‹è¯•

---

## 1ï¸âƒ£1ï¸âƒ£ CI/CD ä¸å‘å¸ƒ

### 11.1 è´¨é‡é—¨ç¦ï¼ˆæ¨èï¼‰

**CI æ£€æŸ¥æ¸…å•**ï¼š
```bash
# 1. é™æ€æ£€æŸ¥
./gradlew detekt
./gradlew ktlintCheck

# 2. å•å…ƒæµ‹è¯• + è¦†ç›–ç‡
./gradlew test jacocoTestReport

# 3. ä¾èµ–æ¼æ´æ‰«æ
./gradlew dependencyCheckAnalyze

# 4. æ„å»º
./gradlew clean build
```

**è´¨é‡é—¨ç¦é˜ˆå€¼**ï¼š
- âœ… Detekt æ£€æŸ¥é€šè¿‡
- âœ… Ktlint æ ¼å¼æ£€æŸ¥é€šè¿‡
- âœ… å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… è¦†ç›–ç‡ â‰¥ 70%ï¼ˆdomain/application â‰¥ 80%ï¼‰
- âœ… æ— é«˜å±ä¾èµ–æ¼æ´

### 11.2 Git å·¥ä½œæµ

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… **MUST** ç¦æ­¢ç›´æ¥ push main/master åˆ†æ”¯
- âœ… **MUST** PR åˆå¹¶å¿…é¡»é€šè¿‡æ‰€æœ‰æ£€æŸ¥
- âœ… **SHOULD** PR æè¿°åŒ…å«å˜æ›´ç‚¹ã€é£é™©ã€éªŒè¯æ–¹å¼ã€å›æ»šæ–¹å¼

**PR æ¨¡æ¿**ï¼š
```markdown
## ğŸ“ å˜æ›´è¯´æ˜
ç®€è¦æè¿°æœ¬æ¬¡å˜æ›´çš„å†…å®¹å’Œç›®çš„ã€‚

## ğŸ” å˜æ›´èŒƒå›´
- [ ] Controller å±‚
- [ ] Service å±‚
- [ ] Repository å±‚
- [ ] æ•°æ®åº“è¿ç§»
- [ ] é…ç½®æ–‡ä»¶

## âœ… éªŒè¯æ–¹å¼
æè¿°å¦‚ä½•éªŒè¯æœ¬æ¬¡å˜æ›´æ˜¯å¦æ­£ç¡®ã€‚

## ğŸš¨ é£é™©è¯„ä¼°
è¯„ä¼°æœ¬æ¬¡å˜æ›´å¯èƒ½å¸¦æ¥çš„é£é™©ã€‚

## ğŸ”„ å›æ»šæ–¹å¼
æè¿°å¦‚ä½•å›æ»šæœ¬æ¬¡å˜æ›´ï¼ˆå¦‚ Docker tagã€ç‰ˆæœ¬å·ï¼‰ã€‚
```

---

## 1ï¸âƒ£2ï¸âƒ£ å¯éªŒè¯ç‚¹æ¸…å•ï¼ˆDoDï¼‰

**å½“å‰é¡¹ç›®çŠ¶æ€**ï¼š

| æ£€æŸ¥é¡¹ | è¦æ±‚ | çŠ¶æ€ |
|--------|------|------|
| `application.yml` | å­˜åœ¨ä¸»é…ç½®æ–‡ä»¶ | âœ… |
| `application-dev.yml` | å¼€å‘ç¯å¢ƒé…ç½® | âœ… |
| `application-prod.yml` | ç”Ÿäº§ç¯å¢ƒé…ç½® | âš ï¸ éœ€åˆ›å»º |
| `spring.jpa.open-in-view=false` | ç¦ç”¨ OSIV | âœ… |
| `@RestControllerAdvice` | ç»Ÿä¸€å¼‚å¸¸å¤„ç† | âœ… |
| Actuator | å¥åº·æ£€æŸ¥ | âš ï¸ æœªå®ç° |
| `@ConfigurationProperties` | ç±»å‹å®‰å…¨é…ç½® | âš ï¸ å¾…ä¼˜åŒ– |
| Flyway | æ•°æ®åº“è¿ç§» | âŒ æœªå®ç° |
| Testcontainers | é›†æˆæµ‹è¯• | âŒ æœªå®ç° |
| JaCoCo | ä»£ç è¦†ç›–ç‡ | âŒ æœªå®ç° |
| Detekt/Ktlint | é™æ€æ£€æŸ¥ | âŒ æœªå®ç° |
| ä¾èµ–æ¼æ´æ‰«æ | å®‰å…¨æ£€æŸ¥ | âŒ æœªå®ç° |

---

## ğŸ“š å‚è€ƒèµ„æº

- [Spring Boot å®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
- [Spring Data JPA å‚è€ƒ](https://spring.io/projects/spring-data-jpa)
- [Kotlin è¯­è¨€æ–‡æ¡£](https://kotlinlang.org/docs/)
- [Flyway æ•°æ®åº“è¿ç§»](https://flywaydb.org/)
- [SpringDoc OpenAPI](https://springdoc.org/)
- [Testcontainers](https://www.testcontainers.org/)
- [OWASP Dependency-Check](https://owasp.org/www-project-dependency-check/)

---

**æœ€åæ›´æ–°**: 2024-01-16
**ç»´æŠ¤è€…**: FinancialApp Team